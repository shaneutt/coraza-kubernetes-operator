apiVersion: v1
kind: ConfigMap
metadata:
  name: base-rules
data:
  rules: |
    SecRuleEngine On
    SecRequestBodyAccess On
    SecResponseBodyAccess Off
    SecAuditLog /dev/stdout
    SecAuditLogFormat JSON
    SecAuditEngine RelevantOnly
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: sqli-rules
data:
  rules: |
    SecRule ARGS "@rx (?i:(\b(select|union|insert|update|delete|drop|create|alter|exec|execute)\b.*\b(from|into|where|table|database|procedure)\b)|(\b(or|and)\b\s*['\"]?\d+['\"]?\s*=\s*['\"]?\d+)|('.*or.*'.*=.*'))" \
      "id:1001,\
      phase:2,\
      block,\
      t:none,t:urlDecodeUni,\
      msg:'SQL Injection Attack Detected',\
      logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',\
      tag:'application-multi',\
      tag:'language-multi',\
      tag:'platform-multi',\
      tag:'attack-sqli',\
      severity:'CRITICAL'"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: xss-rules
data:
  rules: |
    SecRule ARGS "@rx (?i:<script[^>]*>.*?</script>|javascript:|onerror\s*=|onload\s*=|<iframe)" \
      "id:2001,\
      phase:2,\
      block,\
      t:none,t:urlDecodeUni,t:htmlEntityDecode,\
      msg:'XSS Attack Detected',\
      logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',\
      tag:'application-multi',\
      tag:'language-multi',\
      tag:'platform-multi',\
      tag:'attack-xss',\
      severity:'CRITICAL'"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: no-evil-monkeys
data:
  rules: |
    SecRule ARGS|REQUEST_URI|REQUEST_HEADERS "@contains evilmonkey" \
      "id:3001,\
      phase:2,\
      deny,\
      status:403,\
      t:none,t:urlDecodeUni,\
      msg:'Evil Monkey Detected',\
      logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}',\
      tag:'application-multi',\
      tag:'language-multi',\
      tag:'platform-multi',\
      tag:'monkey-attack',\
      severity:'CRITICAL'"
---
apiVersion: waf.k8s.coraza.io/v1alpha1
kind: RuleSet
metadata:
  name: default-ruleset
spec:
  instance: default
  rules:
    - apiVersion: v1
      kind: ConfigMap
      name: base-rules
    - apiVersion: v1
      kind: ConfigMap
      name: sqli-rules
    - apiVersion: v1
      kind: ConfigMap
      name: xss-rules
    - apiVersion: v1
      kind: ConfigMap
      name: no-evil-monkeys
